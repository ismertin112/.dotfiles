#!/bin/bash

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏
DELAY=0.2 # –ó–∞–¥–µ—Ä–∂–∫–∞ –≤ —Å–µ–∫—É–Ω–¥–∞—Ö –ø–µ—Ä–µ–¥ —Å–∫—Ä–∏–Ω—à–æ—Ç–æ–º (–º–æ–∂–Ω–æ –ø–æ–º–µ–Ω—è—Ç—å –Ω–∞ 0.1, 0.3 –∏ —Ç.–¥.)
SLURP_OPTIONS="-b 00000080 -d" # –û–ø—Ü–∏–∏ –¥–ª—è slurp: –ø–æ–ª—É–ø—Ä–æ–∑—Ä–∞—á–Ω—ã–π —á–µ—Ä–Ω—ã–π —Ñ–æ–Ω, –±–µ–∑ —Ä–∞–º–∫–∏ (–º–æ–∂–Ω–æ —É–±—Ä–∞—Ç—å –∏–ª–∏ –∏–∑–º–µ–Ω–∏—Ç—å)

# –ó–∞—Ö–≤–∞—Ç—ã–≤–∞–µ–º –æ–±–ª–∞—Å—Ç—å —Å –ø–æ–º–æ—â—å—é slurp —Å –æ–ø—Ü–∏—è–º–∏
GEOMETRY=$(slurp $SLURP_OPTIONS)

# –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–º–µ–Ω–∏–ª –≤—ã–¥–µ–ª–µ–Ω–∏–µ (–Ω–∞–∂–∞–ª Esc), slurp –≤–µ—Ä–Ω–µ—Ç –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É
if [ -z "$GEOMETRY" ]; then
    notify-send "üì∏ –°–∫—Ä–∏–Ω—à–æ—Ç –æ—Ç–º–µ–Ω–µ–Ω" -i dialog-warning -t 2000
    exit 1
fi

# --- –î–û–ë–ê–í–õ–ï–ù–ê –ó–ê–î–ï–†–ñ–ö–ê ---
# –î–∞–µ–º Hyprland –≤—Ä–µ–º—è "—É—Å–ø–æ–∫–æ–∏—Ç—å—Å—è" –ø–æ—Å–ª–µ –∑–∞–∫—Ä—ã—Ç–∏—è –æ–≤–µ—Ä–ª–µ—è slurp
sleep $DELAY

# –î–µ–ª–∞–µ–º —Å–∫—Ä–∏–Ω—à–æ—Ç –≤—ã–¥–µ–ª–µ–Ω–Ω–æ–π –æ–±–ª–∞—Å—Ç–∏ (grim) –∏ —Å—Ä–∞–∑—É –ø–µ—Ä–µ–¥–∞–µ–º –µ–≥–æ –≤ wl-copy
# grim —Å –ø—É—Ç–µ–º "-" –≤—ã–≤–æ–¥–∏—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ stdout
# wl-copy –±–µ–∑ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ —á–∏—Ç–∞–µ—Ç –∏–∑ stdin
grim -g "$GEOMETRY" - | wl-copy

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–¥ –≤—ã—Ö–æ–¥–∞ wl-copy (0 - —É—Å–ø–µ—Ö)
if [ $? -eq 0 ]; then
    notify-send "üì∏ –°–∫—Ä–∏–Ω—à–æ—Ç —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω" "–û–±–ª–∞—Å—Ç—å —ç–∫—Ä–∞–Ω–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞." -i camera-photo -t 3000
else
    notify-send "üö´ –û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è" "–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å–∫—Ä–∏–Ω—à–æ—Ç –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞." -i dialog-error -t 5000
    exit 1
fi

exit 0
